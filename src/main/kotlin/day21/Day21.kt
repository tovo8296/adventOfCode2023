package day21

import Coord
import Direction
import day10.getOrNull
import java.lang.RuntimeException

fun main() {
    val garden = input.lines().map { it.toList() }
    var positions: Collection<Coord> = listOf(findStart(garden))
    (1..64).forEach {
        positions = findNextSteps(positions, garden)
    }
    println("${positions.size} positions")
}

fun findNextSteps(positions: Collection<Coord>, garden: List<List<Char>>): Collection<Coord> {
    val newPositions = mutableSetOf<Coord>()
    positions.forEach { source ->
        Direction.straightEntries.forEach { direction ->
            val next = direction.go(source)
            val field = garden.getOrNull(next)
            if (field == '.' || field == 'S') {
                newPositions.add(next)
            }
        }
    }
    return newPositions
}

private fun findStart(garden: List<List<Char>>): Coord {
    garden.forEachIndexed { y, line ->
        line.forEachIndexed { x, c ->
            if (c == 'S') {
                return Coord(x, y)
            }
        }
    }
    throw RuntimeException("No start found")
}

private val dummy = """
...........
.....###.#.
.###.##..#.
..#.#...#..
....#.#....
.##..S####.
.##..#...#.
.......##..
.##.#.####.
.##..##.##.
...........
""".trimIndent()

private val input = """
...................................................................................................................................
...#..................#..........#.....#.........#.....#..........................#...#.#......#.....##.............#...........#..
..................................#...........#.....#..#....................#.#......#......#.............##..............#.#....#.
.....#......#............#.......#.....................#........................#.........#................#.........#.............
..#.............#....#...#..............#...#..#.......#...................#..#...........#.#.#.............#....#.................
...................#........#.....#..#.....#.....#...#..........................#..........#.............#..#..#...................
..........#.#.............#.............#.......#......#..........##.........###...#.#....#..#.............#.#.........#.#.........
..#.#..#............#......#................#.....#...........#.................................##.......................#..#...#..
..........#.....#.....#.........#.........##.........................#...................#......#..............................#...
...#..#..#...................#.#...#..........#................#...#....................#..#..............#........#...............
.....#...#...#..............##..........##.#.#........................#...............#....................#.........#...#.........
.#.#.#................##.......................#.............#...........................#.................#.#.....................
..#.......#..............#.............#..#....................#.......#..........#.........#..#.....##.#..................#..#.#..
...#........#.....#..#.#....#.........#.#...............##.##.......................#.....##............#.................#........
.........................#............#..#..............#.#.#.#......#....................#....#.#......#..#..................##...
............#.....#..#...#..#.............#..............#...#.#......#.............#.......##..#........#.#............#..#.......
.................##..............#........#........................#.................#...................#......##.............#...
......#.........##...............#.#.....#.............#.#.............#................#....#.#.#....#......#.........#...........
.#..............#............#........................#...#............#....#.#..................................#.......##.#...#..
..#.........#.........#.##.#......................#...#..#.....#............................#.#....##......#....#....#.........#...
..#.#.....#....#...##.....###..........................##...............#....#....................#....##...#.#....................
...............#...............#...#..#.........#..........#..........#........#...........#...#.........#..#....#..#...#..#.......
.............#..#........#.#............................#..#.#.........#...........................##..............#............#..
........###....................................#.....................#........................#.#........#.........#...............
..#...........#...###...##......#..#..........................#...#.#......#........#.................................#............
........#..........................#.............#..#......#..........#.....#...................................##.##..........#...
................#......#.#......#..#........#..........#.....##.#.#....................#........#....#.##......#..##...............
..#.............#..#............##........#.#.....#...................#.............#...#.........#..............#...#......#....#.
..............#...#.......................................#...#......#......#........#............#...........#........#...#.......
...#..........#.#...........................#.........#..#......#.........#......#..##..................#..........................
.......#..#.................##.........................##............#........#....#...............#.............#...............#.
.....#.....#........#...#..#.#...........#.....#........#.#..........#...#..###...........#..........#................#.......#....
........#............#...................#.....#......#..#.....................###..#...#...................................#....#.
.........#.........#............................#.#.................#..#.#......#.....#..##............#..............#.....#...#..
........................#.......................#...............#.#.......#.........#........#...........###............#..........
.#...........#............#.........#.......#.##.......#.......................#..#........#...................#...................
......................##.#..........................#.##.#...................#.......#...##.#..#....................#...#.......#..
..#...#...#............#.................#.........##.....#...#.........##........#.....#.....##..............#.......#.#.....#....
..#...##....#..................#...#..................#...........#...#.....#.................##...................#............#..
..........#..#....#........................#......#..........#......#..###..........##..#....................#...#.#.#.............
............#.##..#................#......#.#.#......#......#........#.......#.......#..........#.................#......#.....#...
........#........#..........#.....#......##..................#....#...............##......#.#..#..............#..#.....#...........
...........#...#..##.........#...#......#........#.....#.............#....................#..#..#......................#..#.#..#...
........###........................#...........#.....#.#....#......#....#....#...##................#.............#.......#.........
......#..#.#....................##.#...#.........#.#....#.......#...##....#..........#......#.....#..............##....##........#.
..#.....................#..#.#......................#.............##...##............#......#...........#.........#................
.....#........#....................................#...##.................#.....#.......#.......##.................#...#......#....
.....###......................#........#..........#....#..........#.#.......................#..#.#........#.............#..........
.#....#...#.............#...................................#...#........#............#...........#....#.#..#................#.....
.......#....................###..#........#................................##.....#...................#.#..................#.......
.....#...................................#.#..............#.......#............#......##..##...........#....#....................#.
..#...................#...........#..................#...#.##............#.........#..........#..#.....#...#.#..#............#.....
.........#................#.#.#.............#.#..##....#.......#...................#.......#.#..........##....#....................
.................#...#...........#............#......#........................#.....#.......#......#.......#....#.#................
...#..#.........#.#.....#.......##............#..............##.........#.#...##.#.......#.........................................
...............................#........##.........#.....#.............#.#..#...#..#........................#......................
.............#........#...#.........#.........#.#..#.#........................#.....#..............#.............#...........##....
................#..#.........##..#.#...........#...#..#.......#......#....#.............#.........#.........#.....#..............#.
...................#...#...##..................#..........................#...##.........#......#.....#.........#..................
.......................#..#.....#..................#..........#......#...............................#...#..........##.#...........
.................#....#......#.........#...#............#.#.....#....#......#............................................#.........
....................#................#.................#........#........#.............#.....#....##.#....#....#.......#...........
.........#....#..#......#................#....................#...#........#..#.........#.......#.........#.#.....#..#.....#.......
............#.#.........#....#..#.......#.................................#....#....#..................#..#.#........#......#......
......#....................#............#.#.....#....#..............#..............##.....#..........#.........#...................
.................................................................S.................................................................
..................#.#........#...............#....................#..............##...#..#...............#....#...#......#...#.....
........#........#....#.#..........#................#..#..#..##.................#..#.....#....#....................................
..............#.#.................#.....................#.................#.....#.........................#...#..#.................
.........##......#...#....#....#....#.......#.#.....#..............#.......#....................#......#............#..............
............####.##.............................................#..#.........#....#......#..........#.......#......................
..........##...#............#.....#..#.#..#..........#..............##.......#...............#.#....................#..#...........
...............###...............#..#.........###....#....#.....#...................#...#.....#....#...#...#........##..........#..
............#..#..............#.....#.....#.....#.................#........#........#..#.....#.......#.........#...................
..#..............#..........................#.....#....#....##.##..#..#......#.....#......................#.....#...............#..
..##..#.....................#.##...........#.#...#.......#.#.#.................#...#..#.#.........##.....##..####.#.........#......
..#................#..........#.................#...#.....#..........#....##..##..#..#................#......#.....#...............
.#...................#..............#......#................#.....##...#.......#...................#..............#.............#..
.......................#..................#.#.....#.#........#..#.#.....#...#....#.......##............#..#....#................#..
...#...#..........#...........#................#.....#........#....##.............................##.....#......................#..
..........#..........#.....##....#....#....#..#.........#.........#...#..................#....#..#.........................#....#..
...................................#.#............##.#.....#..........##...#...#...................#....#...................#......
.....##...................#..............#...#..................#.####..............#.......#..##.#........#.......................
....#...#....#.........#...#............###..#....#...............#........................#.#...#....................##..#..#.....
...........#.#.........#......#...#....#......##...#....##..#........#.........#.....#......#.........................##.#...#...#.
.........................................#.....#......#...#....#..#......#..............................................##.........
.....##..#.................#...#.........#...#....#.#.##.....................#......#...#................#...........#.......#.....
...#.#.....#..###..................#.....#..#..#....#.......................#.#....##..........#..#...#............................
.#...........#.............#....#...#..#....................................#.......................#..#..........#...........#....
................#...........##...#.##...................#..#...##...............................#.##...........................#.#.
...........###....#............#.....................#......#...........................#.........##...............................
........#.#..#.#...............#.#..........#...........#...................#.......#.............#..................#.............
.#........#............................................###......#.#..........#..............#................#............#....#...
.............................................#.#...#..#.#....#...............#...#..............#......................#...........
.#.#......#..#....##.................##......##..........#.#..#.........#.....#...............##..............................#..#.
...#.#........#.......................#..........#.....#.##...........#................###..........................#.........#....
.........#...........#.................................#.....###....#....#......#.........#.#..............#...#.#.....#...#.......
........#.#...#.......#.....#................#..#.#.............#.......................................#.#.....##...#.##....#.....
...##.............#..#.#........................................................###..................#.#..#...#.................#..
.................##........##..............#.........####......#........#......#......#.....#..............#..#.....#.....#..#.#.#.
.#.#......................................#...........................#..#.........#.##.................#..........#...........#...
.#.........#..#.#......#.......#.............................#....#.........#..#...#...............#......#...#...#............#.#.
.....#.....##......#..###.#..#................................#....#.....#....................................#..#..........#......
....................##............................##.............................#......#................#.........................
...#..............#...#...#......#.#.................#..#..............##.................................................#........
...#.#.......#..............#..#..............#.#...#.........#............#.........#..............##......#...........#.....#....
.#....#..#...#...#......#.................................##...#...#...#...........................#.##.......#....#....#.....#....
.#.#.##.........#...#.......#....#...#........#....#..............#.........................#..##.....#...#....#...#...#........#..
...........#...#.#.........#..#...#.#............##..........#.........#....................#......#..................#....##......
.........#........#.#...#...##......................#.........##....#.##.#................#................#......#....##..........
............#.#............#........#..............##.#.....#.........##.#.....................##...#......#.....#.....#.#....#....
...##...........##...#..................#..........#.......#....#..##..#...#...............##.................#....................
.....#.....#.......................#.##.........................#........#....................#...........##...#.#.#..........##...
..#.#..........#......#..#.#.#....#........#...............#........#.....#.#.........#....#.#...............#................#....
.............................#....###.....#..........#...#..........#.................#...........................##...#.#....#....
.................#....##.#.##...#...#....#..........................#.#...#...................................#.#...#........#...#.
.....#.....................#........##........................#....#.....................#.....#...........#......#..#.#.....#.....
.....#...............#....................#.#.............#...#.......#............#..#.......#..#...#..................#...#.#....
...##.##....#....#..........#..#.....#.....#.##....................#..#.#............#...................#.................#.......
.....#..............#......#...#..#.....#.................#.......#.......................................#........................
..#.................#.#.........##............#................#...............#..........#..........#.#...#.......#....##....#.##.
.........#...................#............#...#..#............#...#...........#.##.....#...#.................#.............##......
.......#.............#.............................###.......#.....................................##...#..............##......#...
..............##.................#......#...................................#.##.......................#....#.......#.#..........#.
.##.........#...##..###........#.#...#..#.......#...#..............................#.....##.............#..#...........#.....#...#.
.#.........#.#...........#.............#......#.........#...................##..................#.#....#..#..........#......#......
........##......#..#..................................#...........................#.#....................##.............#..........
...#..#.....#......#....#...#................#.....#..............................#........................#........#....#.........
...#......#........#..#.......................#.....#...................#............#.......##..................#..#....#..###....
........#.....#..............#...#.#..#..#.......#.#.....#.........................#........#.......#....##......#.............#.#.
...................................................................................................................................
""".trimIndent()