package day13

import kotlin.math.min

enum class Type(val text: Char) {
    Ash('.'),
    Rock('#')
}

fun main() {
    val groups = parse()
    val sum = groups.map {
        findMirror(it, false) ?: (findMirror(it, true)!! * 100)
    }.sum()
    println("Sum: $sum")
}

fun findMirror(group: List<List<Type>>, horiz: Boolean): Int? {
    val size = getDimensionSize(horiz, group)
    return (1 until size).find { i ->
        isMirror(i, group, horiz)
    }
}

fun isMirror(mirror: Int, group: List<List<Type>>, horiz: Boolean): Boolean {
    val mirrorDimSize = getDimensionSize(horiz, group)
    val otherPartSize = mirrorDimSize - mirror
    val checkSize = min(mirror, otherPartSize)
    val otherDimSize = getDimensionSize(!horiz, group)
    return (0 until mirrorDimSize).any { si ->
        (0 until otherDimSize).any { sj ->
            val smudgeInMirrorRange = (mirror - checkSize until mirror + checkSize).contains(si)
            smudgeInMirrorRange && (0 until checkSize).all { offsetFromMirror ->
                (0 until otherDimSize).all { j ->
                    val i1 = mirror - offsetFromMirror - 1
                    val i2 = mirror + offsetFromMirror
                    val type1 = group.get(horiz, i1, j, si, sj)
                    val type2 = group.get(horiz, i2, j, si, sj)
                    type1 == type2
                }
            }
        }
    }
}

private fun List<List<Type>>.get(horiz: Boolean, i: Int, j: Int, smudgeI: Int, smudgeJ: Int): Type {
    val field = if (horiz) this[i][j] else this[j][i]
    return if (i == smudgeI && j == smudgeJ) {
        Type.entries.find { it != field }!!
    }else {
        field
    }
}

private fun getDimensionSize(horiz: Boolean, group: List<List<Type>>) =
    if (horiz) group.size else group[0].size


fun parse(): List<List<List<Type>>> {
    val groups = mutableListOf<List<List<Type>>>()
    var current = mutableListOf<List<Type>>()
    input.lines().forEach { line ->
        if (line.trim().isEmpty()) {
            groups.add(current)
            current = mutableListOf()
        } else {
            current.add(line.map { c ->
                Type.entries.find { it.text == c }!!
            })
        }
    }
    groups.add(current)
    return groups
}

val dummyInput = """
#.##..##.
..#.##.#.
##......#
##......#
..#.##.#.
..##..##.
#.#.##.#.

#...##..#
#....#..#
..##..###
#####.##.
#####.##.
..##..###
#....#..#
""".trimIndent()

val input = """
##....###.#..
########...#.
##.##.##.#.##
........###.#
........#.#.#
#######.###..
.#.##.#.#....
..####..##..#
##.##.##.##.#
##.##.##.##.#
..####..##..#
.#.##.#.#....
#######.###..
........#.#.#
........###.#

#.###..#..###
.#...##.####.
.#...##.####.
#.###..#..###
.#######.##.#
.#..##.#.#..#
..#..#.##.#..
##..##..###.#
######.##..#.
######.##....
##..##..###.#
..#..#.##.#..
.#..##.#.#..#

#......
#......
....#..
#.#.###
#####..
###.##.
...#.##
#.#.###
####.#.
..##..#
..##..#
####.#.
#.#.###
...#.##
###.##.
###.#..
#.#.###

.......#.
.#..#...#
######.##
#.##.##.#
#.##.##.#
#.##.##.#
#.##.####
######.##
.#..#...#

.##.#..#.##.###
####.#..#######
.##.##.#.######
#..#.#..#..#.##
.##.##.##.###..
..#.#.#.#.#.#..
....#.#..#.####

#####.##.##
.##..#.....
.##..####..
####......#
.##.#.##.#.
....##..##.
......##...

...#.##....##.#..
##..##########..#
.####..#..#..####
######..##..#####
#.##.#.####.#.##.
..##.#.#..#.#.##.
.####.######.####
......##..##.....
#.##.#.#..#.#.##.

#.##.##
######.
.#..#..
#.##.##
.#..#.#
......#
.#..#.#
.#..#.#
#....#.
#....##
#....##
#....#.
.#..#.#
.#..#.#
......#
.#..#.#
#.##.#.

..###.#
.#...##
####...
....###
....###
####...
.#...##

##..##......##...
##..##......##..#
.####.##.##.##.#.
.##.#.#..#..##.##
#.#.#.#.####...#.
.......#.#.#..#.#
######.####....#.
######.####....#.
.......#.#.#..#.#
#.#.#.#.####...#.
.##.#.#..#..##.##
.####.##.##.##.#.
##..##......##..#

...##..
..#....
..#....
..###..
###.#.#
##..#.#
.....##
......#
..#.#..

..##.###...####
......###.##.##
.#.#....##...##
#.#####.##..#..
#.####.###.....
....#.##.#..#..
..#.#.#.###....
..#.#.#.###....
....#.##....#..

###.##..#
.#.......
#.#..#..#
##.##....
.#..#.##.
.##...##.
#....####
.#.#.####
.#.#.####
#....####
.##...##.
.#..#.##.
.#.##....
#.#..#..#
.#.......

###.##..##.###...
.#..######..#.#..
##.#......#.##...
.##..####..##..##
####......####...
##.###..###.##.##
.####....####....
##.##....##.#####
...#.#..#......##
#.#.##..##.#.#...
#.##..##..##.##..
.#..#....#..#....
##....##....#####

###..#..#...#
##...#.#..#..
#..##..######
#..##..######
##...#.#..#..
###..#..#...#
###.##..#....
#.#..#..#.###
#########...#
..#...#..#..#
#.##.####..#.
#####...#..##
#...##..###.#
.###....#...#
.###....##..#

#####...#..####
#.....##..##..#
.....####......
#.##.####..####
#.#.#....#.####
##..##..###.##.
###...#.#.#####
#####.#..##....
....#.#.#.#....
...####.#...##.
.###..#...##..#
#....#....#.##.
..#.#####......
.#.#.#.#.##.##.
.#.###.#.##.##.

.##...##..#
.#.....#..#
###.###.##.
#..##..#..#
#..####....
....#..#..#
..#.####..#
..##....##.
#.#.###.##.
.###..#....
#.#.#.##..#
.#.########
.#.########
#.#.#.##..#
.###..#....
#.#.###.##.
.###....##.

##.#.##.#
##.##..##
..#.#..#.
..##....#
##.##..##
###.####.
..#######
....###..
..###..##
###.####.
..#..##..
##..####.
..#######
...#.##.#
##..#..#.

....####.#.....#.
###.#....#.#.#...
..##..###..#..###
..##..###..#..###
###.#....###.#...
....####.#.....#.
###.####.####.###
.#.#.##.#....#...
.#.#.##.#....#...

#..###...
#..#.#...
.....####
####..#.#
....#.##.
#####.##.
####.#.#.
######.##
.##.#..#.
#####.##.
#..#...#.
#..##..#.
####.#.#.
.##..#...
####..##.
.##.#..##
.##.#.##.

###..###.##.#
....#...#..#.
..#.##..#..#.
..##########.
##...###.##.#
####.##.#..#.
###...#######
...#.###....#
..#..########

.########....####
.##.##.##....##.#
#.#.##.#.####.#.#
..##..##......##.
#..#..#..#..#..#.
#.#.##.#.#..#.#.#
...#..#...##...#.
..######..##..###
.##.##.##....####

###.####..#.#
#########.###
#.####...#...
#.####...#...
##.######.###
###.####..#.#
##.#..#.##...
#..#.##.#...#
..#.########.
..#.########.
#..#.##.#...#

#.#......#.##..#.
##..#..#..##.#.##
.###....###.###.#
.#.##..##.#....#.
####.##..###.####
.###....###.....#
.#.#....#.#..#...
.##.####.##.##...
.##.####.##.##...

###.#.##.####.##.
..#..#...#..#...#
.##..#..#....#..#
...###.#......#.#
##..#.#.#.##.#.#.
.#..#..#..##..#..
.#.....#..##..#..

##.#.#...
.####..##
.####..##
##.#.#...
#...##...
...#..###
.###...#.
###..##..
#.###....

...####
..#.###
..#.###
...####
.###..#
.##....
.#..#..
#..##..
..#.###
..#.###
...##..
.#..#..
.##....
.###..#
...####

......##.###....#
###.#.#.#.#####.#
.###.#...##......
#..#.#.##....##..
.#.#.#..#..######
..#####.....####.
..#..#.#.##......
#.#.#.#.##.#.##.#
.#.#.#..#....##..
..##.#.##.##....#
..##.#.##.##....#
.#.#.#..#....##..
#.#.#.#.##.#.##.#

###.#.##.#.###.##
.#.##.#..##.#....
..##..##..##..###
.#.########.#....
.############.#..
.##..#..#..##..##
.###.#..#.###..##
..#.#.##.#.#.....
..#..####..#..#..

##.###.###..#
##.###.###..#
###..#####..#
##.....#....#
..##..#..####
#..#..##.#..#
#....#.#..##.

.#.#.##
#..##..
..#....
.#.####
##..###
#.#..##
.#.#...
##...##
##...##
.#.#...
###..##

.#.##.###.#...#
#.#....##..#...
#.#....##..#...
.#.##.###.#...#
#.#..###.####.#
....####.##..#.
####.....##.#..
.##.#.###...###
##.#####..###..
#.##..#....#.#.
###..##.#.#.##.
#...#...##.##.#
.#...###....##.
.###...###.#...
.###...###.#.#.

##..##......#
####.##.##.##
....#..#..##.
##.#..##..##.
#.....#....#.
#.....#....#.
##.#..##..##.

###.......#
##...##...#
..#.#..#.#.
..#.#..#.#.
..##.##.##.
...######..
...#.##.#..
...######..
..###..###.

##....#####...#
.###....#.###..
##..##..#.##..#
#..#.##.#..##..
#####........##
..#.#.#.#.###.#
###...#..#..###
.#...##.#.###..
..##......#.##.
.#.#.#.##.####.
#####...#.###.#
.#.##.########.
..######..##...
#..#.#..###..##
#..###..###..##
#..###..###..##
#..#.#..###..##

...#.#.#..#
######....#
.#####.#..#
.##...#.##.
#.#.###....
.#.#.#.####
.#.#.#.####

#######.###.#.#
#..#..####.##.#
.##.....##.#...
#..##..#..####.
#..#.#.###...##
.##...#.#..###.
....#.#.#.##...
.......#..#..#.
........#...##.
#..#..##.##.##.
####.##...#.###
####.##...#.###
#..#..##.#..##.
........#...##.
.......#..#..#.
....#.#.#.##...
.##...#.#..###.

...####....
.#.##...###
###.##.##.#
#.#..#...#.
#.#..#...#.
###.##.##.#
.#.##...###
.#.####....
.#.#...##..
....#..#.##
#.###.#.###
#..####...#
#.#.#.#####
#.#.#.#####
#..####...#

..#.#.#
##..#.#
###.#.#
.....##
...#.#.
##...##
...#.#.
##.#...
##.....

#..#.#.....##
##..##.###..#
##.#.#...####
#..#.##.#####
###..........
.##....#.####
..###.#.##...
..###.#.##...
.##....#.####
###..........
#..#.##.#####
#..#.#...####
##..##.###..#
#..#.#.....##
#..#.#.....##

###.#..#.##
....####...
..#####.##.
#...####...
.###....###
.#...##...#
.#.######.#
.####..####
.####..####
.#.######.#
.#...##...#

####..#
#......
#.#####
...#..#
.#.....
.######
#.#####
...####
#......
.#.....
.#.....
#......
..#####
#.#####
.######
.#.....
...#..#

####........#
.##...####...
.##.#.#..#.#.
######....###
.......##....
####........#
.##.#.....##.
.##...#..#...
....#.####.#.

###.####.
#..#....#
#..######
.#..####.
###......
##.#....#
##.#....#
###......
.##.####.
#..######
#..#....#
###.####.
#.#######

..#.#.###.##.
#..###.##..#.
###..##.#.##.
###..##.#.##.
#..###.##..#.
..#.#.###.##.
#####.####...
..#####....##
###.....##.#.
#.####....#..
.###..##.#..#
.###..##.#..#
#.####....#..
###.....##.#.
..#####....##
#####.####...
..#.#.#.#.##.

###.##..##.
.#.###..###
###...##...
......##...
.##.##..##.
...#..##..#
#.#.######.
#.#.#.##.#.
..###....##
###..#####.
.##.#.##.#.
.##########
.#.........
###...##...
##..#.##.#.
#.##.####.#
#.##.####.#

#.#....
#....##
.#.#...
...#.##
....###
#.#..##
#....##
#....##
#.##.##
....###
...#.##
.#.#...
#....##
#.#....
.##....

#.#..##.#..
.#..#.#....
.#.####.#..
###.#..#...
..###..##..
.#..##.####
..##....#..
.#.####....
...#....#..
.#.##......
.###..###..
.##....#.##
####.#.####
#.#......##
#.#....#.##
####.#.####
.##....#.##

######.#..###
#.##.###.....
##..##....#..
.####.#.###..
.........####
.####..#.....
.####..##..##
..##..####...
.#..##.#..#..
#.##.#..#....
#....#..##...
.####.####...
#########.#..
.####.#.##...
..##..##..###
.#..#...##.##
######....###

....#.#.#
#..#.###.
####....#
.##..#..#
#..#.#.#.
########.
#..##...#
#..##...#
########.
#..#.#.##
.##..#..#
####....#
#..#.###.

...#.##..
####..#.#
.########
.########
####..#.#
...#.##..
######..#
....###.#
....###.#
######..#
...#.##..
####..#.#
.#.######

#.#.##.##..#.
#.......###..
##..##.##..#.
..###....#.#.
.#..##..#.##.
.....####..#.
##..##..###.#
##..##..###.#
.....####..#.
.#..##..#.##.
..###....#.#.
##..#####..#.
#.......###..
#.#.##.##..#.
#.#.##.##..#.
#.......###..
##..#####..#.

##.#.##.....#
##.#.##...#.#
#...##..###..
..#.##.#...##
.#.##.#....#.
.#.##.#....#.
..#.##.#...##

###...##..#....
#..#..#..###..#
.#.#####...#..#
#.##..##..#....
#.......##.....
#.####.....#..#
.....#.#.##.##.
#.#...####.....
#.#...####.....
.....#.#.##.##.
#.#####....#..#

#.#..#..##...
#.#..#..##...
.####..##.#.#
#....#.####..
..#..#.#.##.#
..#...##..###
..#...##..###
..#....#.##.#
#....#.####..

............#.#
.##.##.##.#..#.
.##....##.#..##
#..#..#..#...#.
.########.##.##
#..####..##....
#.######.#...#.
.#......#.#.#..
.#......#.#....

..##..##..##..#
##.####.###....
.#.#..#.#..####
....###........
.###..###...##.
.##.##.##.#....
...#..#...#.##.
#..#..#..#.....
###.##.###..##.
##########.#..#
....##.....#..#

#.#..#.#..#####
#..##..###.#...
...##.....#.###
#......#.......
#.####.#.#.#...
##....#.###.###
...##....##.#..

######...
.......##
##..####.
.#..#.###
.#..#.#.#
.####....
######.#.
.####.##.
.####.###

.######....
#..##..###.
.#....#....
########..#
#.#..#.####
..####.....
.#....#....

..#.####.
..#.####.
..#......
###......
#####..##
.#.##..##
.##.#....
...#....#
...######
#..#.##.#
....####.

.###..###..#.
#..#..#..##..
###....######
.###..###..##
.#..##..#..#.
####..#######
.#.#..#.#..#.
##.#..#.####.
....##.......

...####.##.
...#..#....
###..##.###
####.#....#
##.######..
..#.###.#.#
..#.##..#.#

#.##.#.
##.....
##.....
#.##.#.
.#.##.#
#.#.#.#
....###
....###
#.###.#

..#.###.####.
#.####.######
######.######
..#.###.####.
.#.###.......
.##.....#..#.
##..#..##..##
#.#......##..
...#..###..##
.######.####.
#...##.#.##.#
#..#..#..##..
####.##.#..#.

###.##.########
#.#.....##..##.
####.##........
.#.#...........
.#.#.##########
.#.##..........
.....##.##..##.
..####.########
###.###...##...
#.#....#..##..#
.#..#.#########
...#...#..##..#
......#........
...#..#########
##.#....##..##.

#..##..##.###...#
#......#.##.##.#.
..####..####...##
.#.##.#.##...###.
.#.##.#.##...###.
..####..####...##
#......#.##.##.#.
#..##..##.###...#
.#.##.#.#..##..#.
.#.##.#.##.###.#.
........##....###
##.##.####.......
#..#...###.#...#.
#......#.##..##.#
..#..#...#.##...#

.....#..##..#..
#..#...####...#
....#.#..#.#.#.
....##..##..##.
#..###......###
....#.#....#.#.
########..#####
#..###.#..#.###
....####..####.
.##.###.##.###.
.##...######...
.##.##.#..#.##.
####.###..###.#
.##.###....###.
.....########..
#..#.#..##..#.#
#..##.##..##.##

.#####.#..#.#####
#.#.##......##.#.
.#.#..#.##.#..#.#
.#.#.#......#.#.#
##.#.########.#.#
#....########....
#....########....
##.#.########.#.#
.#.#.#......#.#.#
.#.#..#.##.#..#.#
#.#.##......##.#.
.#####.#..#.#####
##..###.##.###..#
#...##....#.##...
...#.##.##.##.#..
..##..#.##.#..##.
###...######...##

.##..#.
.....#.
#####.#
#..#.##
#..####
.##.###
#..#.#.
....###
.....#.
##.#.##
#..##.#
#..##.#
#..#...
.....#.
.....#.

#.##.#.
.###..#
#####.#
#####.#
.###..#
#.##.#.
.###.##
.#..###
.#..###
.###.##
####.#.
.###..#
#####.#

...#.#.##..
...#.#.##..
.#.##....#.
#..#.#.#..#
.##.#.#..#.
#.#.#.#..##
#....####..
##.##.#....
##.##.#....
#....####..
###.#.#..##
.##.#.#..#.
#..#.#.#..#
.#.##....#.
...#.#.##..

###..####....##
###..####.##.##
.#.##.#..####..
########......#
#......#.####.#
.#.##.#...##...
##.....#......#
##....###....##
.#.##.#.#.##.#.

#.#..##
#.##..#
#..#.#.
#..#.#.
#.##..#
#.#.###
..##...
#####..
.#.#..#
.##.##.
##..#..
.#..###
.#..###

..#..###.##..
#...####.##..
#...####.##..
..#..###.##..
##.####...#..
...#.#...#.##
...##.#..##..
.#...##.###.#
.#.#.##.###.#

.###...
...##..
#.###..
#.###..
.#.##..
.###...
..##...
...####
..#.###
.#.....
.#.....
.##....
#....##
..#....
.######
#...#..
###....

##.....##
..#..####
####..#..
###....##
##.#.#.##
.#..##.##
###.#.#..

#.##..##.#.##.##.
.##.#.#...##....#
.....###.#.#.#..#
....#..##.#.#.##.
.......#.####..##
.....#...#.#..##.
#..##.#..##....#.
#..##.#..##....#.
.....#...#.#..##.
.......#.####..##
....#..##.#.#.##.

###.#..#.###.##..
############.#.#.
##..#..#..#####.#
##..#..#..#####.#
############.#.#.
###.#..#.###.##..
.....##.....#..#.
..########...####
##..#..#..######.
.###....###...#..
..##.##.###.#.#.#
..#......#....###
.###.##.###.#..#.
###.####.######.#
#.#..##..#.###.##

###...#####....
......#....#...
#..#.#......#.#
##.....#..#....
##.############
.#.###.####.###
##.#.#.#..#.#.#
#.#.#...##...#.
#.##.##....##.#
#.###.#....#.##
#.###.#....#.##

.##.######.##.#
#....#..#....#.
##############.
#..#.#..#.#..#.
.##..####..##..
####......#####
#..#.#..#.#..#.

........#.##.#.
......##..##..#
#.######......#
#.##.#..##..##.
.#..#.#..####..
..##..#........
########..##..#
#######..####..
.####...#.##.#.

#.#..#.###..#
##..####.#.#.
.####....###.
.####.#.#.#..
.#..#.....###
..##...#.#...
..##...#.#...
.#..#.....###
.####.#.#.#..
.####....###.
##..####.#.#.

.###....###.#
#..#.##.#..#.
#..#.##.#..#.
.###....###.#
..#......#...
...#....#....
#...#..#...##
#..........#.
............#
##.#.##.#.###
##..#..#...##
..########..#
.##.#..#.##..

..####.##.##.
.#..####.##.#
.....#...#..#
.....#...#..#
.#..####.##.#
..####.##.##.
#...#.##...#.
#..#...#..#.#
..#.#.....#..
...#####.#...
#..#..#.#....
#..#..#.#...#
...#####.#...
..#.#.....#..
#..#...#..#.#
#...#.##...#.
..####.##.##.

..#.#...#
..#.#.#.#
..#..#.#.
.###....#
###..##.#
..###..#.
...##..#.
###.###..
.########
.####....
.#.....##
.##..#...
..#.###..
####.#.##
...#####.
...#####.
####.#.##

##..##..#
####.#...
##..#....
...##..#.
...##..#.
##..#....
####.#...
##..###.#
##.###.##
####..##.
##..#.##.
###.#..##
###.##..#
..#.##.#.
#####....

.##.#.###.#..
....#.##..#..
......#.#....
#..#..#.###..
##########...
.##....#.##.#
#..#..#..#...
.##...####.##
#..#.##.##...

...##...##...#..#
#.#...###.###..#.
##..##..#.#.#####
#......#....###.#
#......#....###.#
##..##..#.#.#####
#.#...###.###..##
...##...##...#..#
.#######...#.....
.#.#...###..###.#
.#...####..#.#...
.#...####..#.#...
.#.#...###..###.#

.####......####..
......####.......
#######..########
.#####.##.#####..
.......##.......#
##..###..###..###
.......##.......#

####..##..#
.##..###..#
.....#.####
.##.#..#..#
.....##....
#..##.#....
......#.###
####.######
#######....
.##.#...##.
#..####....
.##...#####
#..#.######

#..#.####
.....#..#
#..#.....
.....####
#.####..#
.##.#.##.
.##......
#####....
....#....

....####.##..
###.....#.##.
......#..###.
...#######.#.
...#######.#.
......##.###.
###.....#.##.
....####.##..
##..#..#..#.#
##.....#...##
..##.#.#..###
##.##.##.##.#
..#..#..####.
..###.#......
##..#.####..#
##.#.#.##..#.
........#####

####.####.###..
....##..##....#
#####....#####.
.#.###..###.#.#
##.########.##.
#.#.######.#.##
##...####...###
##.#..##..#.###
##.#..##..#.##.
..##.####.##..#
....#.##.#.....
....#.##.#.....
..##.####.##..#

..#.##.#...##
#.######.#.##
.#.#..#.#.###
###....###...
#..##.#..#...
.###..###....
#.#....#.#.##

#....###.####
##..##.##....
##..####..##.
#.##.###.....
....#.#.#####
#.##.##..####
.......######
.#..#..#.#..#
#.##.##..#..#
......####..#
.#..#....#..#
#....#.#..##.
.####..#.####

.#..##.##.##.
.###..####..#
##.####..####
...##########
##..##.##.##.
##...........
.......##....
####..#..#..#
##.#..####..#
#...##.##.##.
..##..####..#
#.#..#....#..
#......##....

...##..##.#
#.##...###.
.#..###.##.
.#..###.##.
#.###..###.
...##..##.#
#..#..#.##.
#..#.#.#.##
#####...###
##.#...#.#.
#.####..#.#
#.##..#.##.
#..####.###
.#.#..#.#..
.#.#..#.#..

.###.......
####.......
.#......#.#
......##..#
#.#..#..#..
.#..##.##..
.#..####...
.####.#.#..
.#.####....
##.#.##..#.
##.#.##..#.

#####.###
.#####.##
..#.#.###
..#.#.##.
.#####.##
#####.###
##.#....#
#..##....
#..##....
""".trimIndent()